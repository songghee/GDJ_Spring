<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- mapper namespace는 비우면 에러 -->
 <!-- namespace의 값은 중복x -->
<!-- 해당 mapper를 사용할 DAO의 풀패키지명으로 작성 -->
<mapper namespace="com.winter.app.regions.RegionDAO">

  <sql id="search3">
  	<!-- TITLE, CONTENTS, WRITER -->
  	WHERE
  	<choose>
  		<when test="kind=='kind1'">
  			TITLE LIKE '%'||#{search}||'%'
  		</when>
  		
  		<when test="kind=='kind2'">
  			CONTENTS LIKE '%'||#{search}||'%'
  		</when>
  		
  		<otherwise>
  			WRITER LIKE '%'||#{search}||'%'
  		</otherwise>
  	</choose>
  </sql>

  
  <sql id="search2">
  	<!-- TITLE, CONTENTS, WRITER -->
  	<where>
  	<if test="kind=='kind1' or kind=='kind4'">
  	TITLE LIKE '%'||#{search}||'%'
  	</if>
  	
  	<if test="kind=='kind2' or kind=='kind4'">
  	OR CONTENTS LIKE '%'||#{search}||'%'
  	</if>
  	
  	<if test="kind=='kind3' or kind=='kind4'">
  	OR WRITER LIKE '%'||#{search}||'%'
  	</if>
  	</where>
  	
  	
  </sql>


  <sql id="search">
  	WHERE REGION_NAME LIKE '%'||#{search}||'%'
  </sql>
  
  <!-- Delete -->
  <delete id="delete" parameterType="RegionDTO">
  	DELETE REGIONS WHERE REGION_ID=#{region_id}
  	
  </delete>
 
  <!-- update -->
  <update id="update" parameterType="RegionDTO">
  	UPDATE REGIONS SET REGION_NAME=#{region_name}
  	WHERE REGION_ID=#{region_id}
  </update>
  
  <!-- Insert -->
  <!-- SEQ: 테이블 매꾸기 -->
  <insert id="add" parameterType="RegionDTO">
  	INSERT INTO REGIONS
  	VALUES(EMPLOYEES_SEQ.NEXTVAL, #{region_name})
  </insert>
  
  <!-- detail -->
  <!-- id는DAO의 메서드명 -->
  <select id="getDetail" resultType="com.winter.app.regions.RegionDTO" parameterType="RegionDTO">
  SELECT * FROM REGIONS WHERE REGION_ID=#{region_id}
  </select>
  
  <!-- getTotal -->
  <select id="getTotal" resultType="Long" parameterType="Pager">
  SELECT COUNT(REGION_ID) FROM REGIONS
  	<include refid="search"></include>
  </select>
  
  <!-- list -->
  
  <select id="getList" resultType="RegionDTO" parameterType="Pager">
  	SELECT * FROM
  	(
  		SELECT ROWNUM R, RG. * FROM
  			(
  				SELECT * FROM REGIONS
   				<include refid="search"/>
   				ORDER BY REGION_ID DESC
  			)RG
  	)
  	WHERE R BETWEEN #{startRow} AND #{lastRow}

  </select>
  
  <!-- <select id="getDetail" resultType="java.util.HashMap" parameterType="com.winter.app.regions.RegionDTO">
		SELECT REGION_ID, REGION_NAME FROM REGIONS WHERE REGION_ID=#{region_id}
	</select>
	
	list
	<select id="getList" resultType="java.util.HashMap">
		SELECT * FROM REGIONS
	</select> -->
</mapper>